# 9.摄像机

上章中，我们介绍了几个坐标系统。其中有一个概念是观察空间，是用来将世界坐标转换成观察坐标用的。而这个过程使用的矩阵，就被称为观察矩阵。

### 摄像机

摄像机就好像是我们的眼睛，我们从摄像机的方向观察世界空间中的模型。摄像机远离模型，模型自然就变小了（透视投影下），然而，在GL中事实上并没有摄像机的概念。但是`我们可以通过移动世界空间远离我们的摄像机来模拟摄像机远离世界的感觉`。这也正是在上一章中，我们的观察矩阵是(0,0,-3)的原因。我们通过将世界矩阵向屏幕里移动3个单位模拟摄像机向屏幕外移动三个单位。

上一章中，我们只是很简单的设置了一个观察矩阵，这一章，我们来仔细说一下如何设置这个观察矩阵，也就是，如何确定摄像机所在的坐标系。

### 观察矩阵

事实上我们所要做的事就是确定一个观察矩阵，就可以完成从世界空间到观察空间的转换。而这在三维空间内，`实际就是确定观察空间坐标系相对于世界空间坐标系的位置及各轴的夹角即可`。如果你空间感足够好的话，或者相对位置足够简单的话，你可能很快的就可以写出观察坐标系的表达式。但情况比较复杂的时候你可能需要耗费大量时间去完成这个转换，下面，我将尝试用一个通俗易懂的方式来介绍一下如何去生成这个坐标系。

![摄像机](https://learnopengl-cn.github.io/img/01/09/camera_axes.png)


### 摄像机的位置

这个很好理解，比如你规定了地面上一个物体作为世界的原点，那么随着你眼睛相对远点的位置改变时，你所看到的物体的样子也会随之改变。所以眼睛相对于远点的位置会直接影响物体的样子，同理，`我们也需要确定摄像机相对于世界空间坐标原点的位置`。这里你可以看下上面图中的第一个图片来理解。坐标系就是世界空间，我们要确定的就是摄像机在世界空间中的位置。

### 摄像机的方向

同样，即是你站在一个位置不动，你将目光集中在物体上不同的点时，你所看到的物体也不同。或者说，你目光的方向改变时，物体也跟着改变。同理，`我们还需要确定摄像机观察的方向`。第二张图中就显示了摄像机在当前位置看向世界空间远点的示例。

### 摄像机的滚转角

好了，现在你站在一个位置不动，目光也一直盯着物体的中心点不动，你还可以让你看到的物体改变。除了闭眼睛，你还可以歪一下头，你看到的东西是不是斜过来了（你非说没变那是因为强大的大脑已经帮你转换回来了又，你可以把眼睛换成手机摄像头然后倾斜手机再看看，手动滑稽）。所以，`我们要确定摄像机在世界空间中摆放的夹角`。这么表述可能不清楚，稍微借一点坐标系的概念。**我们摄像机的方向就是观察坐标系的Z轴。但是一个Z轴确定却并不能确定一个坐标系，我们至少要确定两个坐标轴，才能通过两个坐标轴确定第三个坐标轴从而建立一个坐标系**。第四张图就显示了确定三个轴夹角后的坐标系。

### 观察坐标系

经过上面的论述，我们知道了，我们只要知道`摄像机的位置`、`摄像机的方向`和`x或y轴中任意一个轴的方向`即可确定。

> 在接下来的教程里，我们会假定摄像机的滚转角不再改变。这样做的好处是无论摄像机的方向是怎样的，摄像机坐标系的x轴与世界坐标系的y轴总是空间垂直的，同理，摄像机坐标系的y轴与世界坐标系的x轴也总是空间垂直的。有了这个特点，我们可以很方便的确定一个摄像机坐标系。

如果我们不改变滚转角保证了摄像机坐标系的x轴与世界坐标系的y轴总是空间垂直，我们就可以通过`摄像机方向向量与世界坐标系的y轴的方向向量叉乘从而获得摄像机坐标系的x轴`（两向量叉乘将获得同时垂直于两个向量的第三个向量）。

### Look At

我们已经知道如何去构建一个摄像机坐标系了，不过怎么通过这些元素构建出观察矩阵呢？glm为我们提供了LookAt(position,target,up)函数。它含有三个参数：

- position，第一个参数就是我们摄像机在世界坐标系的位置了
- target，第二个参数是我们观察的点的位置，就是我们目光汇聚的那个点了，为什么是目标点呢？因为通过position减去target我们就可以获得摄像机方向的向量了
- up，第三个参数是一个与摄像机坐标系x轴垂直的向量。为什么是这个向量呢？因为我们可以通过position和target确定摄像机的方向，也就是摄像机坐标系z轴。再找到一个也与x轴垂直的向量即可确定x轴的方向向量了。

所以，上一章中我们生成的观察矩阵可以通过lookAt函数这样生成：

```
glm::mat4 view = glm::lookAt(glm::vec3(0.0f, 0.0f, 3.0f), 
           glm::vec3(0.0f, 0.0f, 0.0f), 
           glm::vec3(0.0f, 1.0f, 0.0f));
```

上面函数中，描述了我们的摄像机在世界坐标系的(0,0,3)位置，我们观察的点就是世界坐标原点，这个up向量就是世界坐标系的y轴的方向向量。

> 事实上，如果我们的滚转角不发生改变的话，那么我们所需要的up向量就一直是(0,1,0)。

那么现在，我们将我们的target保持在(0,0,0)这个点上，通过改变position来改变我们的lookAt矩阵。我们可以大概猜想一下结果就应该是我们围着一个东西转圈一直盯着这个东西的样子。

下面这段代码在渲染循环中：

```
float radius = 10.0f;
float camX = sin(glfwGetTime()) * radius;
float camZ = cos(glfwGetTime()) * radius;
glm::mat4 view;
view = glm::lookAt(glm::vec3(camX, 0.0, camZ), glm::vec3(0.0, 0.0, 0.0), glm::vec3(0.0, 1.0, 0.0)); 
```

这一部分代码

